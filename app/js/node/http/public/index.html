<html>
<body>

<div>
    <div>
        <label>Number of images : </label>
        <select onchange="onImageNumberChange(this)">
            <option value="10" selected="selected">10</option>
            <option value="25">25</option>
            <option value="100">100</option>
        </select>
    </div>
    <div>
        <label>Refresh rate : </label>
        <select onchange="onRefreshRateChange(this)">
            <option value="5">5</option>
            <option value="10" selected="selected">10</option>
            <option value="60">60</option>
        </select>
        s
    </div>
</div>

<div style="display: flex; flex-wrap: wrap">

    <div id="container"/>


</div>
<script>


    let imageCount = 10;
    let refreshRate = 10;
    let timeout;

    function repaint(){
        console.log('repainting');
        document.getElementById("container").innerHTML = '';
        for(let i=0; i<imageCount; i++){
            console.log(imageCount)
            console.log('image '+i)
            const randomCount = Math.round(Math.random() * 21);
            const randomDisableCache = Math.round(Math.random() * 100000);
            const img = document.createElement('img');
            img.style.cssText="width: 100px; height: 100px; margin: 3px; background-color: #3F51B5";
            document.getElementById("container").appendChild(img);

            fetch(`https://qrgtkvh0zk.execute-api.eu-west-1.amazonaws.com/default/fractal?preset=${randomCount}&width=100&height=100&random=${randomDisableCache}`, {
                method: "GET", // *GET, POST, PUT, DELETE, etc.
                mode: "cors", // no-cors, cors, *same-origin
                cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                headers: {
                    "Accept": "image/png",
                }
                //body: JSON.stringify(data), // body data type must match "Content-Type" header
            })
                .then(r => new Response(r.body))
                .then(response => response.blob())
                .then(blob => URL.createObjectURL(blob))
                .then(url => console.log(img.src = url))


                .catch(e=> {console.error(e)});
        }
    }



    function onImageNumberChange(event){
        imageCount = event.value;
        repaint();
    }
    function onRefreshRateChange(event){
        clearTimeout(timeout);
        refreshRate = event.value;
        restartTimeout();
        repaint();
    }

    function restartTimeout(){
        timeout = setTimeout(()=>{
            repaint();
            restartTimeout();
        }, refreshRate * 1000);
    }


    repaint();
    restartTimeout();

</script>
</body>
</html>
